generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model User {
  id              String          @id @default(uuid())
  email           String?         @unique
  phone           String?         @unique
  password    String?
  fullName        String?
  role            Role            @default(CUSTOMER)
  isPhoneVerified Boolean         @default(false)
  isEmailVerified Boolean         @default(false)
  otp             String?
  otps            Otp[]           @relation("Otp")
  otpExpiry       DateTime?

  profile         Profile?
  wallet          Wallet?
  bankAccount     BankAccount?
  oauthAccounts   OAuthAccount[]
  riderLocation   RiderLocation?

  // Ride relations
  passengerRides  Ride[]          @relation("PassengerRides")
  riderRides      Ride[]          @relation("RiderRides")

  // Delivery relations
  sentDeliveries  Delivery[]      @relation("SenderDeliveries")
  riderDeliveries Delivery[]      @relation("RiderDeliveries")

  refreshToken    String?

  // Ratings
  givenRatings    Rating[]        @relation("UserRatings")
  receivedRatings Rating[]        @relation("RiderRatings")

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}



model Profile {
  id          String @id @default(uuid())
  user        User   @relation(fields: [userId], references: [id])
  userId      String @unique

  nin         String?
  ninDocument String?
  selfie      String?
  bvn         String?
}




model BankAccount {
  id           String @id @default(uuid())
  user         User   @relation(fields: [userId], references: [id])
  userId       String @unique

  accountNumber String
  accountName   String
  bankName      String
  verified      Boolean @default(false)
}



model OAuthAccount {
  id         String @id @default(uuid())
  provider   String
  providerId String

  user       User   @relation(fields: [userId], references: [id])
  userId     String
}


model Wallet {
  id          String        @id @default(uuid())
  user        User          @relation(fields: [userId], references: [id])
  userId      String        @unique

  balance     Float         @default(0)
  transactions Transaction[]
}

model Transaction {
  id        String   @id @default(uuid())
  wallet    Wallet   @relation(fields: [walletId], references: [id])
  walletId  String
  amount    Float
  type      String
  meta      Json?
  createdAt DateTime @default(now())
}



model RiderLocation {
  id         String   @id @default(uuid())
  rider      User     @relation(fields: [riderId], references: [id])
  riderId    String   @unique

  latitude   Float
  longitude  Float
  isAvailable Boolean @default(true)
  updatedAt  DateTime @updatedAt
}




model Ride {
  id           String     @id @default(uuid())

  passenger    User       @relation("PassengerRides", fields: [passengerId], references: [id])
  passengerId  String

  rider        User?      @relation("RiderRides", fields: [riderId], references: [id])
  riderId      String?

  originLat    Float
  originLng    Float
  destLat      Float
  destLng      Float
  price        Float
  status       RideStatus @default(PENDING)

  rating       Rating?    @relation("RideRatings")

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}




model Delivery {
  id        String   @id @default(uuid())

  sender    User     @relation("SenderDeliveries", fields: [senderId], references: [id])
  senderId  String

  rider     User?    @relation("RiderDeliveries", fields: [riderId], references: [id])
  riderId   String?

  originLat Float
  originLng Float
  destLat   Float
  destLng   Float

  status    DeliveryStatus @default(PENDING)
  price     Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}



model Rating {
  id        String @id @default(uuid())

  user      User   @relation("UserRatings", fields: [userId], references: [id])
  userId    String

  rider     User   @relation("RiderRatings", fields: [riderId], references: [id])
  riderId   String

  ride      Ride?  @relation("RideRatings", fields: [rideId], references: [id])
  rideId    String? @unique

  score     Int
  comment   String?
  createdAt DateTime @default(now())
}



model Promotion {
  id           String @id @default(uuid())
  code         String @unique
  description  String?
  discountPercent Int?
  discountFlat Float?
  startsAt     DateTime
  endsAt       DateTime
  maxUses      Int?
  createdAt    DateTime @default(now())
}

model Otp {
  id          String @id @default(uuid())
  user        User?   @relation("Otp", fields: [userId], references: [id])
  userId      String? @unique
  phone       String @unique
  otp         String
  expiresAt   DateTime
  password    String?
  fullName    String?
  email       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Role {
  CUSTOMER
  RIDER
  ADMIN
}

enum RideStatus {
  PENDING
  ACCEPTED
  ONGOING
  COMPLETED
  CANCELLED
}

enum DeliveryStatus {
  PENDING
  ACCEPTED
  PICKED
  IN_TRANSIT
  DELIVERED
  CANCELLED
}
